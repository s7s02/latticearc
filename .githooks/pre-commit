#!/bin/bash
# Pre-commit hook: Format all Rust code before committing
#
# To enable this hook, run:
#   git config core.hooksPath .githooks

set -e

echo "Running cargo fmt..."

# Format all code
cargo fmt --all

# Check if formatting made any changes
if ! git diff --quiet; then
    echo ""
    echo "Code was reformatted. Adding changes to commit..."
    # Add any formatted files that were already staged
    git diff --name-only | while read file; do
        if git diff --cached --name-only | grep -q "^$file$"; then
            git add "$file"
        fi
    done
    echo "Formatting complete. Staged files updated."
fi

echo "Pre-commit checks passed."
