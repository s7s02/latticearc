# Shared cargo-deny Configuration for Rust 2024
# Enhanced supply chain security for both Apache and Proprietary repositories
# Using version 2 format for cargo-deny 0.18+

[graph]
# Target platforms for dependency resolution
targets = [
    "x86_64-unknown-linux-gnu",
    "x86_64-apple-darwin",
    "aarch64-apple-darwin",
    "x86_64-pc-windows-msvc",
]

[advisories]
# Use version 2 format
version = 2

# Path to advisory database
db-path = "~/.cargo/advisory-db"

# Advisory database URLs (use official sources only)
db-urls = ["https://github.com/rustsec/advisory-db"]

# Ignore specific advisories (only if necessary)
ignore = []

[bans]
# Allow or deny multiple versions of the same crate
multiple-versions = "warn"

# Wildcard dependencies (allow but warn)
wildcards = "allow"

# Highlight all issues
highlight = "all"

# Workspace default features (allow)
workspace-default-features = "allow"

# External default features (allow)
external-default-features = "allow"

# Explicitly allowed crates
allow = []

# Explicitly denied crates
# Note: libc and nix are required by some dependencies, so we allow them
deny = []

# Skip specific crates
skip = []

# Skip entire dependency trees
skip-tree = []

[licenses]
# Use version 2 format (all licenses denied unless explicitly allowed)
version = 2

# Confidence threshold for license detection
confidence-threshold = 0.8

# Allowed licenses (all permissive licenses we accept)
allow = [
    "MIT",
    "Apache-2.0",
    "Apache-2.0 WITH LLVM-exception",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Unicode-DFS-2016",
    "Unicode-3.0",
    "CC0-1.0",
    "CC-BY-3.0",
    "CC-BY-4.0",
    "MPL-2.0",
    "OpenSSL",
    "Zlib",
    "BSL-1.0",
    "Unlicense",
    "0BSD",
    "BlueOak-1.0.0",
    "CDLA-Permissive-2.0",
]

# License exceptions (if needed)
exceptions = []

[licenses.private]
# Ignore private licenses (false for compliance)
ignore = false

[sources]
# Unknown registries (deny - security risk)
unknown-registry = "deny"

# Unknown git sources (deny - security risk)
unknown-git = "deny"

# Allowed git sources (only official repos)
allow-git = [
    "https://github.com/rust-bitcoin/rust-secp256k1",
    "https://github.com/rust-lang/crates.io-index",
]
